---
interface Props {
  title: string;
}

const { title} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="icon" href="/icon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="/icon.svg" />
    <meta name="theme-color" content="#030712" />
    <meta name="application-name" content="Scribe" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="Scribe" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="mobile-web-app-capable" content="yes" />
    <title>{title}</title>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <style>
      /* Global animation variables */
      :root {
        --transition-fast: 150ms;
        --transition-base: 200ms;
        --transition-slow: 300ms;
        --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
        --ease-out: cubic-bezier(0, 0, 0.2, 1);
        --ease-in: cubic-bezier(0.4, 0, 1, 1);
      }

      /* Respect prefers-reduced-motion */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Page fade-in animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      body {
        animation: fadeIn var(--transition-slow) var(--ease-out);
      }

      /* Smooth hover effects for interactive elements */
      a, button {
        transition: all var(--transition-fast) var(--ease-in-out);
      }

      /* Enhanced button hover with subtle scale */
      button:not(:disabled):hover {
        transform: translateY(-1px);
      }

      button:not(:disabled):active {
        transform: translateY(0);
      }

      /* Modal animations */
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(16px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .animate-fadeIn {
        animation: fadeIn var(--transition-base) var(--ease-out);
      }

      .animate-slideUp {
        animation: slideUp var(--transition-slow) var(--ease-out);
      }

      /* Stagger animation for lists */
      @keyframes staggerFadeIn {
        from {
          opacity: 0;
          transform: translateY(4px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Apply stagger to list items */
      .stagger-item {
        animation: staggerFadeIn var(--transition-base) var(--ease-out);
      }

      .stagger-item:nth-child(1) { animation-delay: 0ms; }
      .stagger-item:nth-child(2) { animation-delay: 50ms; }
      .stagger-item:nth-child(3) { animation-delay: 100ms; }
      .stagger-item:nth-child(4) { animation-delay: 150ms; }
      .stagger-item:nth-child(5) { animation-delay: 200ms; }
      .stagger-item:nth-child(6) { animation-delay: 250ms; }
      .stagger-item:nth-child(7) { animation-delay: 300ms; }
      .stagger-item:nth-child(8) { animation-delay: 350ms; }
      .stagger-item:nth-child(9) { animation-delay: 400ms; }
      .stagger-item:nth-child(10) { animation-delay: 450ms; }
    </style>
  </head>
  <body class="min-h-screen bg-gray-950 text-gray-100">
    <slot />

    <!-- Keyboard Shortcuts Help Modal -->
    <div id="shortcuts-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn">
      <div class="bg-gray-900 border border-gray-800 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-auto animate-slideUp">
        <div class="sticky top-0 bg-gray-900 border-b border-gray-800 p-4 flex items-center justify-between">
          <h2 class="text-xl font-light text-gray-200">Keyboard Shortcuts</h2>
          <button id="close-shortcuts" class="text-gray-400 hover:text-gray-200 text-2xl leading-none">&times;</button>
        </div>

        <div class="p-6 space-y-6">
          <!-- Global Shortcuts -->
          <section>
            <h3 class="text-sm font-semibold text-gray-400 uppercase mb-3">Global</h3>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Show this help</span>
                <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">?</kbd>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Close modal / Clear textarea</span>
                <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">Esc</kbd>
              </div>
            </div>
          </section>

          <!-- Navigation Shortcuts -->
          <section>
            <h3 class="text-sm font-semibold text-gray-400 uppercase mb-3">Navigation</h3>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Go to Capture</span>
                <div class="flex gap-1">
                  <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">g</kbd>
                  <span class="text-gray-600">then</span>
                  <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">c</kbd>
                </div>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Go to Browse</span>
                <div class="flex gap-1">
                  <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">g</kbd>
                  <span class="text-gray-600">then</span>
                  <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">b</kbd>
                </div>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Go to Archive</span>
                <div class="flex gap-1">
                  <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">g</kbd>
                  <span class="text-gray-600">then</span>
                  <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">a</kbd>
                </div>
              </div>
            </div>
          </section>

          <!-- Capture Page Shortcuts -->
          <section>
            <h3 class="text-sm font-semibold text-gray-400 uppercase mb-3">Capture Page</h3>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Submit note</span>
                <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">Ctrl/Cmd + Enter</kbd>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Refine note</span>
                <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">Ctrl/Cmd + R</kbd>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Explore / Ask</span>
                <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">Ctrl/Cmd + E</kbd>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Clear textarea</span>
                <kbd class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm">Ctrl/Cmd + K</kbd>
              </div>
            </div>
          </section>
        </div>

        <div class="sticky bottom-0 bg-gray-900 border-t border-gray-800 p-4 text-center text-sm text-gray-500">
          Press <kbd class="px-1.5 py-0.5 bg-gray-800 border border-gray-700 rounded text-xs">Esc</kbd> to close
        </div>
      </div>
    </div>

    <!-- Footer hint -->
    <div class="fixed bottom-4 right-4 text-xs text-gray-600">
      Press <kbd class="px-1.5 py-0.5 bg-gray-800 border border-gray-700 rounded">?</kbd> for shortcuts
    </div>

    <script>
      // Keyboard shortcuts system
      let gPressed = false;
      let gPressedTimeout: number | null = null;

      // Check if user is typing in an input/textarea
      function isTyping() {
        const activeElement = document.activeElement;
        return (
          activeElement instanceof HTMLInputElement ||
          activeElement instanceof HTMLTextAreaElement ||
          activeElement instanceof HTMLElement && activeElement.isContentEditable
        );
      }

      // Show/hide shortcuts modal
      function toggleShortcutsModal() {
        const modal = document.getElementById('shortcuts-modal');
        if (modal) {
          modal.classList.toggle('hidden');
        }
      }

      function hideShortcutsModal() {
        const modal = document.getElementById('shortcuts-modal');
        if (modal) {
          modal.classList.add('hidden');
        }
      }

      // Global keyboard handler
      document.addEventListener('keydown', (e) => {
        // Handle Escape key
        if (e.key === 'Escape') {
          // Close modal if open
          const modal = document.getElementById('shortcuts-modal');
          if (modal && !modal.classList.contains('hidden')) {
            hideShortcutsModal();
            return;
          }

          // Clear textarea if on capture page
          const textarea = document.getElementById('note-input') as HTMLTextAreaElement;
          if (textarea && document.activeElement === textarea) {
            textarea.value = '';
            e.preventDefault();
          }
          return;
        }

        // Show shortcuts modal on ?
        if (e.key === '?' && !isTyping()) {
          toggleShortcutsModal();
          e.preventDefault();
          return;
        }

        // "g" sequence navigation (Gmail-style)
        if (e.key === 'g' && !isTyping() && !e.ctrlKey && !e.metaKey) {
          gPressed = true;
          if (gPressedTimeout) clearTimeout(gPressedTimeout);
          gPressedTimeout = setTimeout(() => {
            gPressed = false;
          }, 1000);
          return;
        }

        if (gPressed && !isTyping()) {
          let targetUrl = '';
          if (e.key === 'c') targetUrl = '/';
          else if (e.key === 'b') targetUrl = '/browse';
          else if (e.key === 'a') targetUrl = '/archive';

          if (targetUrl) {
            window.location.href = targetUrl;
            gPressed = false;
            e.preventDefault();
            return;
          }
        }

        // Capture page shortcuts (Ctrl/Cmd + key)
        if ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) {
          // Submit note: Ctrl/Cmd + Enter
          if (e.key === 'Enter') {
            const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
            if (submitBtn) {
              submitBtn.click();
              e.preventDefault();
            }
            return;
          }

          // Refine: Ctrl/Cmd + R
          if (e.key === 'r') {
            const refineBtn = document.getElementById('refine-btn') as HTMLButtonElement;
            if (refineBtn) {
              refineBtn.click();
              e.preventDefault();
            }
            return;
          }

          // Explore/Ask: Ctrl/Cmd + E
          if (e.key === 'e') {
            const askBtn = document.getElementById('ask-btn') as HTMLButtonElement;
            if (askBtn) {
              askBtn.click();
              e.preventDefault();
            }
            return;
          }

          // Clear textarea: Ctrl/Cmd + K
          if (e.key === 'k') {
            const textarea = document.getElementById('note-input') as HTMLTextAreaElement;
            if (textarea) {
              textarea.value = '';
              textarea.focus();
              e.preventDefault();
            }
            return;
          }
        }
      });

      // Close modal on button click
      document.getElementById('close-shortcuts')?.addEventListener('click', hideShortcutsModal);

      // Close modal on outside click
      document.getElementById('shortcuts-modal')?.addEventListener('click', (e) => {
        if (e.target === e.currentTarget) {
          hideShortcutsModal();
        }
      });

    </script>
  </body>
</html>
